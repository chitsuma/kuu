<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MLBB Diamond Shop</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS ·ÄÄ·ÄØ·Äí·Ä∫·Äû·Ää·Ä∫ ·Äô·Ä∞·Äõ·ÄÑ·Ä∫·Ä∏·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·Äê·Ä∞·Ää·ÄÆ·Äï·Ä´·Äû·Ää·Ä∫·Åã ·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫ ·Äô·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äû·Ä±·Ä¨·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫ ·Äñ·Äª·ÄÄ·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã */
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="header">
        <div class="logo">Kuu-MLBB-Diamonds-Store</div>
        <div class="subtitle">" Myanmar Sever ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫·Äû·Ä¨·Äõ·Äô·Ää·Ä∫ "</div>
        <button class="admin-btn" onclick="openAdminPanelWithAuth()">Admin</button>
    </div>

    <!-- Announcement Banner -->
    <div class="announcement-banner">
        <div class="announcement-content">
            <span class="announcement-icon"><i class="fas fa-bullhorn"></i></span>
            <span class="announcement-text">·Äô·Äî·ÄÄ·Ä∫ 9 ·Äî·Ä¨·Äõ·ÄÆ·Äô·Äæ ·Ää 12 ·Äî·Ä¨·Äõ·ÄÆ·Ä°·Äë·Ä≠·Äù·Äö·Ä∫·Äö·Ä∞·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫ 
                <a href="https://t.me/KuuDiamond_Bot" target="_blank" class="announcement-link"></a>
            </span>
            <span class="announcement-close" onclick="closeAnnouncement()"><i class="fas fa-times"></i></span>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mlbbContent">
        <!-- Regular Diamonds Section -->
        <div style="padding: 0 1rem; margin-top: 1rem;">
            <h3 style="color: var(--mlbb-accent); border-bottom: 2px solid var(--mlbb-secondary); padding-bottom: 0.5rem; display: flex; align-items: center;">
                <i class="fas fa-gem" style="margin-right: 0.5rem;"></i>
                Diamond ·Äô·Äª·Ä¨·Ä∏
            </h3>
        </div>

        <!-- Regular Diamonds -->
        <div class="diamond-grid">
            <div class="diamond-card" onclick="openModal('11 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">11 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('22 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">22 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('56 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">56 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('86 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">86 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('172 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">172 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('257 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">257 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('343 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">343 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('514 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">514 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('600 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">600 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('706 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">706 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('1049 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">1049 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('1412 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">1412 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('2118 Diamonds', 'mlbb')">
                <div class="diamond-icon"><i class="fas fa-gem"></i></div>
                <div class="diamond-amount">2118 Diamonds</div>
                <div class="diamond-price">Loading...</div>
            </div>
        </div>

        <!-- Pass Section -->
        <div style="padding: 0 1rem; margin-top: 2rem;">
            <h3 style="color: var(--mlbb-accent); border-bottom: 2px solid var(--mlbb-secondary); padding-bottom: 0.5rem; display: flex; align-items: center;">
                <i class="fas fa-ticket-alt" style="margin-right: 0.5rem;"></i> Pass ·Äô·Äª·Ä¨·Ä∏
            </h3>
        </div>
        <div class="diamond-grid">
            <div class="diamond-card" onclick="openModal('Weekly Pass', 'mlbb')">
                <div class="badge">PASS</div>
                <div class="diamond-icon"><i class="fas fa-ticket-alt"></i></div>
                <div class="diamond-amount">Weekly Pass</div>
                <div class="diamond-price">Loading...</div>
            </div>
            <div class="diamond-card" onclick="openModal('Twilight Pass', 'mlbb')">
                <div class="badge">PASS</div>
                <div class="diamond-icon"><i class="fas fa-ticket-alt"></i></div>
                <div class="diamond-amount">Twilight Pass</div>
                <div class="diamond-price">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Orders Section -->
    <div id="ordersContent" class="orders-container">
        <div class="no-orders">·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´</div>
    </div>

    <!-- Purchase Modal -->
    <div id="purchaseModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2 class="modal-title" id="modalTitle">Diamonds ·Äù·Äö·Ä∫·Äö·Ä∞·Äõ·Äî·Ä∫</h2>
            
            <div class="payment-info" id="paymentInfo" style="padding: 0;">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <div class="payment-select-wrapper" style="position: relative;">
                        <select id="paymentMethod" class="form-control" required style="padding: 0.8rem 1rem; background: white; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 8px; appearance: none; width: 100%; color: var(--mlbb-light); font-size: 0.9rem;">
                            <option value="" selected disabled>·ÄÑ·ÄΩ·Ä±·Äú·ÄΩ·Äæ·Ä≤·Äî·Ää·Ä∫·Ä∏·Äú·Äô·Ä∫·Ä∏ ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´</option>
                            <option value="wave1">WavePay - 09252540287 (9 AM - 12 PM)</option>
                            <option value="kpay">KPay - 09252540287 (9 AM - 12 PM)</option>
                        </select>
                        <div class="select-arrow" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); pointer-events: none; color: var(--mlbb-primary);">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                </div>
                
                <div id="selectedPaymentDetails" style="display: none; background: rgba(74, 107, 255, 0.05); border-radius: 8px; padding: 1rem; margin-top: 0.5rem; border: 1px solid rgba(74, 107, 255, 0.1);">
                    <div class="payment-method-card" style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                        <div class="payment-icon-circle" style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--mlbb-primary), var(--mlbb-purple)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.8rem; flex-shrink: 0;">
                            <i class="fas fa-mobile-alt" style="color: white; font-size: 1rem;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--mlbb-light); font-size: 0.9rem;" id="paymentMethodName"></div>
                            <div style="font-size: 0.85rem; color: var(--mlbb-light); margin-top: 0.2rem;" id="paymentAccountDetails"></div>
                            <div style="font-size: 0.75rem; color: #4CAF50; margin-top: 0.3rem; display: flex; align-items: center;">
                                <i class="fas fa-clock" style="margin-right: 0.3rem; font-size: 0.7rem; color: #4CAF50;"></i>
                                <span id="processingTime"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <form id="purchaseForm">
                <input type="hidden" id="selectedPackage">
                <input type="hidden" id="gameType">
                
                <div class="form-group">
                    <label for="gameId" id="gameIdLabel">·ÄÇ·Ä≠·Äô·Ä∫·Ä∏ ID</label>
                    <input type="text" id="gameId" class="form-control" placeholder="·Äû·ÄÑ·Ä∑·Ä∫·ÄÇ·Ä≠·Äô·Ä∫·Ä∏ ID ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´" required>
                </div>
                
                <div class="form-group" id="serverGroup">
                    <label for="serverId">·ÄÜ·Ä¨·Äó·Ä¨ ID</label>
                    <input type="text" id="serverId" class="form-control" placeholder="·Äû·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä¨·Äó·Ä¨ ID ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´" required>
                </div>
                
                <div class="form-group">
                    <label for="paymentProof">·ÄÑ·ÄΩ·Ä±·Äï·Ä±·Ä∏·ÄÅ·Äª·Ä±·Äô·Äæ·ÄØ ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·ÄÅ·Äª·ÄÄ·Ä∫ (·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂)</label>
                    <div class="file-upload">
                        <div class="file-upload-btn" id="fileUploadLabel">
                            <i class="fas fa-cloud-upload-alt"></i><br>
                            ·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä´
                        </div>
                        <input type="file" id="paymentProof" accept="image/*" required>
                    </div>
                </div>
                
                <div class="spinner" id="spinner"></div>
                
                <button type="submit" class="submit-btn" id="submitBtn">
                    <i class="fas fa-paper-plane"></i> ·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äê·ÄÑ·Ä∫·Äô·Ää·Ä∫
                </button>
            </form>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <a href="#" class="nav-item active" onclick="showHome()">
            <i class="fas fa-gem"></i>
            <span>Diamonds</span>
        </a>
        <a href="#" class="nav-item" onclick="showOrders()">
            <i class="fas fa-clipboard-list"></i>
            <span>·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏</span>
        </a>
        <a href="#" class="nav-item" onclick="showHelp()">
            <i class="fas fa-question-circle"></i>
            <span>Help</span>
        </a>
    </div>

    <!-- Help Section -->
    <div id="helpContent" class="orders-container" style="display: none;">
        <div class="help-item" onclick="showIdCorrectionForm()">
            <i class="fas fa-exclamation-triangle"></i>
            <span>ID ·Äô·Äæ·Ä¨·Ä∏·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äñ·Äº·Ä±·Äõ·Äæ·ÄÑ·Ä∫·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫</span>
            <i class="fas fa-chevron-right"></i>
        </div>
        <div class="help-item" onclick="window.open('https://t.me/KuuDiamond_Bot', '_blank')">
            <i class="fas fa-paper-plane"></i>
            <span>Official Channel</span>
            <i class="fas fa-chevron-right"></i>
        </div>
        <div class="help-item" onclick="showDiamondNotReceivedInfo()">
            <i class="fas fa-clock"></i>
            <span>Diamond ·Äô·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏</span>
            <i class="fas fa-chevron-right"></i>
        </div>
    </div>

    <!-- ID Correction Modal -->
    <div id="idCorrectionModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeIdCorrectionModal()">&times;</span>
            <h2 class="modal-title">ID ·Äô·Äæ·Ä¨·Ä∏·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äñ·Äº·Ä±·Äõ·Äæ·ÄÑ·Ä∫·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫</h2>
            
            <form id="idCorrectionForm">
                <div class="form-group">
                    <label for="correctionGameId">·ÄÇ·Ä≠·Äô·Ä∫·Ä∏ ID (·Ä°·Äû·ÄÖ·Ä∫)</label>
                    <input type="text" id="correctionGameId" class="form-control" placeholder="·ÄÇ·Ä≠·Äô·Ä∫·Ä∏ ID ·Ä°·Äû·ÄÖ·Ä∫·Äë·Ää·Ä∑·Ä∫·Äï·Ä´" required>
                </div>
                
                <div class="form-group">
                    <label for="correctionServerId">·ÄÜ·Ä¨·Äó·Ä¨ ID (·Ä°·Äû·ÄÖ·Ä∫)</label>
                    <input type="text" id="correctionServerId" class="form-control" placeholder="·ÄÜ·Ä¨·Äó·Ä¨ ID ·Ä°·Äû·ÄÖ·Ä∫·Äë·Ää·Ä∑·Ä∫·Äï·Ä´" required>
                </div>
                
                <div class="form-group">
                    <label for="correctionProof">·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äô·Äæ·Äê·Ä∫·Äê·Äî·Ä∫·Ä∏·Äï·ÄØ·Ä∂</label>
                    <div class="file-upload">
                        <div class="file-upload-btn" id="correctionFileLabel">
                            <i class="fas fa-cloud-upload-alt"></i><br>
                            ·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä´
                        </div>
                        <input type="file" id="correctionProof" accept="image/*" required>
                    </div>
                </div>
                
                <div class="spinner" id="correctionSpinner"></div>
                
                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i> ·Äï·Ä±·Ä∏·Äï·Ä≠·ÄØ·Ä∑·Äô·Ää·Ä∫
                </button>
            </form>
        </div>
    </div>

    <!-- Diamond Not Received Modal -->
    <div id="diamondNotReceivedModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeDiamondNotReceivedModal()">&times;</span>
            <h2 class="modal-title">Diamond ·Äô·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏</h2>
            
            <div class="payment-info" style="text-align: left; padding: 15px;">
                <p style="margin-bottom: 15px; line-height: 1.6;">
                    Diamond ·Äô·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äô·Äæ·Ä¨<br>
                    ·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äê·ÄÑ·Ä∫·Äë·Ä¨·Ä∏·Äê·Ä≤·Ä∑ Game ID ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫<br>
                    Server ID ·Äô·Äæ·Ä¨·Ä∏·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏ ·Äê·Ä≠·ÄØ·Ä∑·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äñ·Äº·ÄÖ·Ä∫·Äû·Ää·Ä∫<br>
                    ·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äô·Äæ·Äê·Ä∫·Äê·Äî·Ä∫·Ä∏·Äê·ÄΩ·ÄÑ·Ä∫ ·ÄÖ·ÄÖ·Ä∫‚Äå·ÄÜ·Ä±·Ä∏·Äï·Ä´
                </p>
                
                <p style="line-height: 1.6;">
                    ·Ä°·ÄÄ·ÄØ·Äî·Ä∫·Äô·Äæ·Äî·Ä∫·Äï·Ä´·Äû·Ä±·Ä¨·Ä∫·Äú·Ää·Ä∫·Ä∏ ·Äô·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äï·Ä´·ÄÄ<br>
                    10 ·Äô·Ä≠·Äî·ÄÖ·Ä∫·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´<br>
                    ·Äô·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äõ·ÄÑ·Ä∫<br>
                    ·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÄ·Äº·Ä¨·Ä∏·Äï·Ä±·Ä∏·Äï·Ä´
                    Telegram @Maxx2104
                </p>
            </div>
            
            <button class="submit-btn" onclick="closeDiamondNotReceivedModal()" style="margin-top: 20px;">
                <i class="fas fa-check"></i> ·Äî·Ä¨·Ä∏·Äú·Ää·Ä∫·Äï·Ä´·Äû·Ää·Ä∫
            </button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAdminPanel()">&times;</span>
            <h2 class="modal-title">Admin - ·Äà·Ä±·Ä∏·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫</h2>
            
            <div id="priceEditor"></div>
            
            <button class="submit-btn" onclick="savePrices()">üíæ Save Prices</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCnVB_DoPLd2VXvKMJapSDpJAmwjnG9dWw",
            authDomain: "shadow-shop-2e6c7.firebaseapp.com",
            databaseURL: "https://shadow-shop-2e6c7-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "shadow-shop-2e6c7",
            storageBucket: "shadow-shop-2e6c7.appspot.com",
            messagingSenderId: "730209164376",
            appId: "1:730209164376:web:ab04f2c8603addccea3e2d"
        };

        const TELEGRAM_BOT_TOKEN = '8402294532:AAG3zY4ytNeluo7nk19su8YeH33jenpewqY';
        const TELEGRAM_GROUP_ID = 't.me/KuuDiamond_Bot';
        let currentGame = 'mlbb';

        // Open purchase modal
        function openModal(packageName, gameType) {
            document.getElementById('selectedPackage').value = packageName;
            document.getElementById('gameType').value = gameType;
            document.getElementById('modalTitle').textContent = packageName + ' ·Äù·Äö·Ä∫·Äö·Ä∞·Äõ·Äî·Ä∫';

            document.getElementById('serverGroup').style.display = 'block';
            document.getElementById('gameIdLabel').textContent = '·ÄÇ·Ä≠·Äô·Ä∫·Ä∏ ID';

            document.getElementById('purchaseModal').style.display = 'block';
            document.body.style.overflow = 'hidden';

            document.getElementById('spinner').style.display = 'none';
            document.getElementById('submitBtn').style.display = 'block';
            document.getElementById('purchaseForm').reset();
            document.getElementById('fileUploadLabel').innerHTML = `
                <i class="fas fa-cloud-upload-alt"></i><br>
                ·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä´
            `;
        }

        // Close modal
        function closeModal() {
            document.getElementById('purchaseModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Send to Telegram
        async function sendTelegramPhotoWithCaption(file, caption) {
            const formData = new FormData();
            formData.append('chat_id', TELEGRAM_GROUP_ID);
            formData.append('photo', file);
            formData.append('caption', caption);
            formData.append('parse_mode', 'HTML');

            const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error sending to Telegram:', error);
                throw error;
            }
        }

        // Submit handler
        document.getElementById('purchaseForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const packageName = document.getElementById('selectedPackage').value;
            const gameType = document.getElementById('gameType').value;
            const gameId = document.getElementById('gameId').value;
            const serverId = document.getElementById('serverId').value;
            const paymentProof = document.getElementById('paymentProof').files[0];
            const paymentMethod = document.getElementById('paymentMethod').value;

            // Validate payment method selection
            if (!paymentMethod) {
                alert("·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·ÄÑ·ÄΩ·Ä±·Äú·ÄΩ·Äæ·Ä≤·Äî·Ää·Ä∫·Ä∏·Äú·Äô·Ä∫·Ä∏ ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´");
                return;
            }

            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('spinner').style.display = 'block';

            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour12: true, hour: 'numeric', minute: 'numeric' });

            // Get payment phone number based on selected method
            let paymentPhone = '';
            switch(paymentMethod) {
                case 'wave1':
                    paymentPhone = '09252540287';
                    break;
                case 'kpay':
                    paymentPhone = '09252540287';
                    break;
            }

            const messageText = `üì¢ New Order\n\n` +
                `üíé Item Name: ${packageName}\n` +
                `üì± ·ÄÑ·ÄΩ·Ä±·Äú·ÄΩ·Äæ·Ä≤ PH: ${paymentPhone}\n` +
                `üÜî Game ID: ${gameId}\n` +
                `üåê Server ID: ${serverId}\n\n` +
                `‚è∞ ·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫: ${timeStr}`;

            try {
                await sendTelegramPhotoWithCaption(paymentProof, messageText);
                closeModal();
                showSuccessBanner();
                addToOrders(packageName, gameType, gameId, serverId, timeStr);
            } catch (err) {
                console.error("Telegram error:", err);
                showSuccessBanner();
                document.getElementById('spinner').style.display = 'none';
                document.getElementById('submitBtn').style.display = 'block';
            }
        });

        // Add order to UI and storage
        function addToOrders(packageName, gameType, gameId, serverId) {
            const now = new Date();
            const dateStr = now.toLocaleDateString('my-MM', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const timeStr = now.toLocaleTimeString('my-MM', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });

            const ordersContainer = document.getElementById('ordersContent');

            const orderCard = document.createElement('div');
            orderCard.className = 'order-card';
            orderCard.innerHTML = `
                <div class="order-header">
                    <span>${packageName}</span>
                    <span class="order-status">·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äê·ÄÑ·Ä∫·Äë·Ä¨·Ä∏·Äû·Ää·Ä∫</span>
                </div>
                <div class="order-details">
                    <div>·ÄÇ·Ä≠·Äô·Ä∫·Ä∏ ID: ${gameId}</div>
                    ${gameType === 'mlbb' ? `<div>·ÄÜ·Ä¨·Äó·Ä¨ ID: ${serverId}</div>` : ''}
                    <div>·Ä°·Äô·Äª·Ä≠·ÄØ·Ä∏·Ä°·ÄÖ·Ä¨·Ä∏: ${getGameTypeName(gameType)}</div>
                </div>
                <div class="order-date">${dateStr} ${timeStr}</div>
            `;

            ordersContainer.insertBefore(orderCard, ordersContainer.firstChild);

            // Hide "no orders" message if it exists
            const noOrdersMsg = ordersContainer.querySelector('.no-orders');
            if (noOrdersMsg) {
                noOrdersMsg.style.display = 'none';
            }

            // Save to localStorage
            let orders = JSON.parse(localStorage.getItem('ordersList') || '[]');
            orders.unshift({ 
                packageName, 
                gameType, 
                gameId, 
                serverId, 
                dateStr, 
                timeStr 
            });
            
            // Keep only last 50 orders to prevent storage overflow
            if (orders.length > 50) {
                orders = orders.slice(0, 50);
            }
            
            localStorage.setItem('ordersList', JSON.stringify(orders));
        }

        // Get game type name in Burmese
        function getGameTypeName(gameType) {
            switch(gameType) {
                case 'mlbb': return 'Mobile Legends';
                case 'pubg': return 'PUBG Mobile';
                case 'tiktok': return 'TikTok';
                default: return gameType;
            }
        }

        // Load orders from localStorage
        function loadOrdersFromStorage() {
            const storedOrders = JSON.parse(localStorage.getItem('ordersList') || '[]');
            const ordersContainer = document.getElementById('ordersContent');

            if (storedOrders.length > 0) {
                ordersContainer.innerHTML = '';
                storedOrders.forEach(order => {
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    orderCard.innerHTML = `
                        <div class="order-header">
                            <span>${order.packageName}</span>
                            <span class="order-status">·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äê·ÄÑ·Ä∫·Äë·Ä¨·Ä∏·Äû·Ää·Ä∫</span>
                        </div>
                        <div class="order-details">
                            <div>·ÄÇ·Ä≠·Äô·Ä∫·Ä∏ ID: ${order.gameId}</div>
                            ${order.gameType === 'mlbb' ? `<div>·ÄÜ·Ä¨·Äó·Ä¨ ID: ${order.serverId}</div>` : ''}
                            <div>·Ä°·Äô·Äª·Ä≠·ÄØ·Ä∏·Ä°·ÄÖ·Ä¨·Ä∏: ${getGameTypeName(order.gameType)}</div>
                        </div>
                        <div class="order-date">${order.dateStr} ${order.timeStr}</div>
                    `;
                    ordersContainer.appendChild(orderCard);
                });
            } else {
                ordersContainer.innerHTML = `<div class="no-orders">
                    <i class="fas fa-clipboard-list"></i>
                    <div>·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´</div>
                </div>`;
            }
        }

        // Load orders on startup
        window.addEventListener('DOMContentLoaded', function() {
            loadOrdersFromStorage();
        });

        // Show success banner
        function showSuccessBanner() {
            const successBanner = document.createElement('div');
            successBanner.className = 'success-banner';
            successBanner.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <div>
                    <div>·Äï·Ä±·Ä∏·Äï·Ä≠·ÄØ·Ä∑·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫</div>
                    <div style="font-size:0.8rem; margin-top:2px;">·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äê·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫</div>
                </div>
            `;

            document.body.appendChild(successBanner);

            setTimeout(() => {
                successBanner.style.animation = 'fadeIn 0.5s ease reverse';
                setTimeout(() => {
                    document.body.removeChild(successBanner);
                }, 500);
            }, 3000);
        }

        // Navigation
        function showHome() {
            document.getElementById('mlbbContent').style.display = 'block';
            document.getElementById('ordersContent').style.display = 'none';
            document.getElementById('helpContent').style.display = 'none';

            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function showOrders() {
            document.getElementById('mlbbContent').style.display = 'none';
            document.getElementById('ordersContent').style.display = 'block';
            document.getElementById('helpContent').style.display = 'none';

            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        // File upload label
        document.getElementById('paymentProof').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileUploadLabel').innerHTML = `
                    <i class="fas fa-check-circle"></i><br>
                    ${file.name}
                `;
            }
        });

        // Modal click outside
        window.addEventListener('click', function(event) {
            if (event.target === document.getElementById('purchaseModal')) {
                closeModal();
            }
        });

        // Close announcement banner
        function closeAnnouncement() {
            document.querySelector('.announcement-banner').style.display = 'none';
            localStorage.setItem('announcementClosed', 'true');
        }

        // Check if announcement was previously closed
        function checkAnnouncement() {
            if (!localStorage.getItem('announcementClosed')) {
                document.querySelector('.announcement-banner').style.display = 'block';
            }
        }

        // Show help section
        function showHelp() {
            document.getElementById('mlbbContent').style.display = 'none';
            document.getElementById('ordersContent').style.display = 'none';
            document.getElementById('helpContent').style.display = 'block';

            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        // Show ID correction form
        function showIdCorrectionForm() {
            document.getElementById('idCorrectionModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // Close ID correction modal
        function closeIdCorrectionModal() {
            document.getElementById('idCorrectionModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Handle ID correction form submission
        document.getElementById('idCorrectionForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const gameId = document.getElementById('correctionGameId').value;
            const serverId = document.getElementById('correctionServerId').value;
            const proof = document.getElementById('correctionProof').files[0];

            document.getElementById('correctionSpinner').style.display = 'block';
            document.querySelector('#idCorrectionForm .submit-btn').style.display = 'none';

            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour12: true, hour: 'numeric', minute: 'numeric' });

            const messageText = `üì¢ ID ·Ä°·Äû·ÄÖ·Ä∫·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äë·Ä¨·Ä∏·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏\n\n` +
                `üÜî New Game ID: ${gameId}\n` +
                `üåê New Server ID: ${serverId}\n\n` +
                `‚è∞ Time: ${timeStr}`;

            try {
                await sendTelegramPhotoWithCaption(proof, messageText);
                closeIdCorrectionModal();
                showSuccessBanner();
            } catch (err) {
                console.error("Telegram error:", err);
                showSuccessBanner();
            } finally {
                document.getElementById('correctionSpinner').style.display = 'none';
                document.querySelector('#idCorrectionForm .submit-btn').style.display = 'block';
            }
        });

        // File upload label for correction form
        document.getElementById('correctionProof').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('correctionFileLabel').innerHTML = `
                    <i class="fas fa-check-circle"></i><br>
                    ${file.name}
                `;
            }
        });

        // Diamond Not Received Modal Functions
        function showDiamondNotReceivedInfo() {
            document.getElementById('diamondNotReceivedModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeDiamondNotReceivedModal() {
            document.getElementById('diamondNotReceivedModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        document.getElementById('paymentMethod').addEventListener('change', function() {
            const method = this.value;
            const detailsDiv = document.getElementById('selectedPaymentDetails');
            
            if (method) {
                detailsDiv.style.display = 'block';
                
                let methodName, accountNumber, accountHolder, processingTime;
                
                switch(method) {
                    case 'wave1':
                        methodName = 'WavePay';
                        accountNumber = '0000';
                        accountHolder = 'Atilla Shiro';
                        processingTime = '·Äî·Ä∂·Äî·ÄÄ·Ä∫ 9 AM ·Äô·Äæ ·Ää 12 PM ·Äë·Ä≠·Ä°·Ä¨·Ä∏·Äû·Ää·Ä∫';
                        break;
                    case 'kpay':
                        methodName = 'KPay';
                        accountNumber = '000';
                        accountHolder = 'Atilla Shiro';
                        processingTime = '·Äî·Ä∂·Äî·ÄÄ·Ä∫ 9 AM ·Äô·Äæ ·Ää 12 PM ·Äë·Ä≠·Ä°·Ä¨·Ä∏·Äû·Ää·Ä∫';
                        break;
                }
                
                document.getElementById('paymentMethodName').textContent = methodName;
                document.getElementById('paymentAccountDetails').innerHTML = `
                    <span style="font-weight: 500;">${accountNumber}</span><br>
                    <span style="color: rgba(0, 0, 0, 0.7);">${accountHolder}</span>
                `;
                document.getElementById('processingTime').textContent = processingTime;
            } else {
                detailsDiv.style.display = 'none';
            }
        });

        // Firebase Initialize
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Admin Panel ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫
        function openAdminPanel() {
            const editorDiv = document.getElementById("priceEditor");
            editorDiv.innerHTML = "";

            // Diamond cards loop (MLBB only)
            const diamondCards = document.querySelectorAll("#mlbbContent .diamond-card");
            
            diamondCards.forEach((card, index) => {
                const amount = card.querySelector(".diamond-amount").innerText;
                const priceText = card.querySelector(".diamond-price").innerText;
                const price = priceText.replace(" Ks", "").trim();

                editorDiv.innerHTML += `
                    <div class="form-group">
                        <label>${amount}</label>
                        <input type="number" id="priceInput_${index}" value="${price}" class="form-control" />
                    </div>
                `;
            });

            document.getElementById("adminPanel").style.display = "block";
        }

        // Modal ·Äï·Ä≠·Äê·Ä∫
        function closeAdminPanel() {
            document.getElementById("adminPanel").style.display = "none";
        }

        // Firebase ·Äû·Ä≠·ÄØ·Ä∑ ·Äà·Ä±·Ä∏·Äô·Äª·Ä¨·Ä∏ Save
        function savePrices() {
            const newPrices = {};
            const diamondCards = document.querySelectorAll("#mlbbContent .diamond-card");
            
            diamondCards.forEach((card, index) => {
                const amount = card.querySelector(".diamond-amount").innerText;
                const input = document.getElementById(`priceInput_${index}`);
                if (input) {
                    const val = parseInt(input.value) || 0;
                    newPrices[amount] = val;
                }
            });

            // Firebase ·Äô·Äæ·Ä¨·Äû·Ä¨·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫ (MLBB only)
            db.ref("prices").set(newPrices, function(error) {
                if (error) {
                    alert("‚ùå Price update failed!");
                    console.error("Firebase error:", error);
                } else {
                    alert("‚úÖ Prices updated successfully!\n·Äú·Ä∞·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äô·Äæ·Ä¨ ·Äà·Ä±·Ä∏·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏ ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äû·ÄΩ·Ä¨·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã");
                    
                    // UI ·ÄÄ·Ä≠·ÄØ·Äú·Ää·Ä∫·Ä∏ update ·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫
                    updatePricesUI(newPrices);
                    
                    closeAdminPanel();
                }
            });
        }

        // Firebase ·Äô·Äæ ·Äà·Ä±·Ä∏·Äô·Äª·Ä¨·Ä∏ Load
        function loadPricesFromFirebase() {
            db.ref("prices").once('value').then(function(snapshot) {
                const prices = snapshot.val();
                if (prices) {
                    updatePricesUI(prices);
                }
            }).catch(function(error) {
                console.error("Firebase read error:", error);
            });
        }

        // UI ·ÄÄ·Ä≠·ÄØ update ·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∑·Ä∫ function (MLBB only)
        function updatePricesUI(prices) {
            document.querySelectorAll("#mlbbContent .diamond-card").forEach((card) => {
                const amount = card.querySelector(".diamond-amount").innerText;
                if (prices[amount] !== undefined) {
                    card.querySelector(".diamond-price").innerText = prices[amount] + " Ks";
                }
            });
        }

        // Admin Panel ·ÄÄ·Ä≠·ÄØ password ·Äî·Ä≤·Ä∑·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·ÄÅ·Äª·ÄÄ·Ä∫·Äö·Ä∞·Äô·Äö·Ä∫
        function openAdminPanelWithAuth() {
            const password = prompt("Admin Password ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´:");
            if (password === "AtillaShirokuu2025") {
                openAdminPanel();
            } else {
                alert("‚ùå Password ·Äô·Äæ·Ä¨·Ä∏·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫!");
            }
        }

        // ·ÄÖ·Äú·ÄØ·Ä∂·Ä∏ Run
        window.onload = function () {
            loadPricesFromFirebase();
            document.querySelector('.admin-btn').setAttribute('onclick', 'openAdminPanelWithAuth()');
            checkAnnouncement();
        };
    </script>
</body>
</html>